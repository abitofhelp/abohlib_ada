--   =============================================================================
--   Test_Constrained_Strings - Implementation
--   =============================================================================
--   Copyright (c) 2025 A Bit of Help, Inc.
--   SPDX-License-Identifier: MIT
--   =============================================================================

pragma Ada_2022;

with Ada.Strings.Unbounded; use Ada.Strings.Unbounded;
--   with Abohlib.Core.Domain.Errors;

package body Test_Constrained_Strings is

--   use Abohlib.Core.Domain.Errors;

--   ==========================================================================
--   Test Functions
--   ==========================================================================

   function Test_Constrained_String_Concept return Void_Result.Result is
   begin
--  Test the concept of constrained strings
--  In real implementation, would test actual constrained string operations
      return Void_Result.Ok (True);
   end Test_Constrained_String_Concept;

   function Test_Path_String_Constraints return Void_Result.Result is
   begin
--  Test path string constraints
--  In real implementation, would test path validation
      return Void_Result.Ok (True);
   end Test_Path_String_Constraints;

   function Test_Filename_Constraints return Void_Result.Result is
   begin
--  Test filename constraints
--  In real implementation, would test filename validation
      return Void_Result.Ok (True);
   end Test_Filename_Constraints;

   function Test_Email_Constraints return Void_Result.Result is
   begin
--  Test email constraints
--  In real implementation, would test email validation
      return Void_Result.Ok (True);
   end Test_Email_Constraints;

--   ==========================================================================
--   Run All Tests
--   ==========================================================================

   function Run_All_Tests
     (Output : access Test_Output_Port'Class) return Test_Stats_Result.Result
   is
      Tests : Test_Results_Array (1 .. 4);
      Index : Positive := 1;

      procedure Add_Test_Result
        (Name : String;
         Test_Func : Test_Function_Access)
      is
         Result : constant Test_Result_Pkg.Result :=
            Run_Test (Name, Test_Func, Output);
      begin
         if Result.Is_Ok then
            Tests (Index) := Result.Get_Ok;
            Print_Test_Result (Tests (Index), Output);
            Index := Index + 1;
         else
--  Handle test execution error
            declare
               Error : constant Test_Error := Result.Get_Err;
            begin
               Tests (Index) := Test_Result'(
                  Name           => To_Unbounded_String (Name),
                  Status         => Failed,
                  Message        => Error.Message,
                  Elapsed_Time   => 0.0,
                  Line_Number    => Error.Line_Number,
                  Correlation_ID => To_Unbounded_String ("TEST-" & Name)
               );
               Print_Test_Result (Tests (Index), Output);
               Index := Index + 1;
            end;
         end if;
      end Add_Test_Result;

   begin
      Output.Write_Line ("=== Running Constrained Strings Unit Tests ===");
      Output.Write_Line ("");

--  Run all tests
      Add_Test_Result ("Test_Constrained_String_Concept", Test_Constrained_String_Concept'Access);
      Add_Test_Result ("Test_Path_String_Constraints", Test_Path_String_Constraints'Access);
      Add_Test_Result ("Test_Filename_Constraints", Test_Filename_Constraints'Access);
      Add_Test_Result ("Test_Email_Constraints", Test_Email_Constraints'Access);

--  Generate summary
      declare
         Stats_Result : constant Test_Stats_Result.Result :=
            Run_Test_Suite ("Constrained_Strings_Tests", Tests (1 .. Index - 1), Output);
      begin
         if Stats_Result.Is_Ok then
            declare
               Stats : constant Test_Statistics := Stats_Result.Get_Ok;
            begin
               Output.Write_Line ("");
               Print_Test_Summary ("Constrained Strings Unit Tests", Stats, Output);
               return Test_Stats_Result.Ok (Stats);
            end;
         else
            return Stats_Result;
         end if;
      end;
   end Run_All_Tests;

end Test_Constrained_Strings;